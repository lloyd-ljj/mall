# 项目背景

## 1.分布是基础概念

### 微服务

微服务架构风格，就是将单独的应用程序开发为一套小服务，每个小服务运行在自己的进程中，并使用轻量级机制通信（HTTP API）。拒绝大型单体应用，基于业务边界进行微服务微化拆分，各个服务独立部署运行。

---

### 集群&分布式&节点

集群是物理形态，分布式是工作方式。集群指的是将几台服务器集中在一起，实现同一业务；分布式是指不同的业务分布在不同的地方。
例如：京东是一个分布式系统，众多业务运行在不同的机器，所有业务构成一个大型的业务集群。
节点：集群中的一个服务器。
分布式中每一个节点，都可以做集群。但集群并不一定是分布式的。

---

### 远程调用

分布式系统中，各个服务可能处于不同主机，服务之间的调用称作远程调用。SpringCloud中使用HTTP+JSON完成。

---

### 负载均衡

为了使每一个服务器不要太忙或太闲，可以使用负载均衡来调用服务器，提升网站健壮性。

常见算法：

- 轮询：依次从第一个到最后一个
- 最小连接：优先选择连接少、压力小的服务器
- 散列：同一个用户分配到同一个服务器

---

### 服务注册/发现&注册中心

A服务调用B服务，可以通过注册中心找到B服务的服务器，从而避免调用不可用的服务

---

### 服务熔断&服务降级

在微服务架构中，微服务之间通过网络进行通信，存在相互依赖，其中一个服务不可用时，有可能会造成雪崩效应，需要容错机制去保护。

（1）服务熔断：设置服务的超时时间，当被调用的服务经常失败达到某个阈值，可以开启断路保护机制，后来的请求不再去调用该服务，直接返回默认的数据。
（2）服务降级：当系统处于高峰期，系统资源紧缺，可以让非核心业务降级运行。某些服务不处理、或者简单处理（抛异常、返回null等）

---

### API网关

在微服务架构中，API Gateway作为整体架构的重要组件，抽象了微服务中需要的公共功能，同时提供了客户端负载均衡、服务自动熔断、灰度发布、统一认证、限流流控、日志统计等功能，帮助解决API管理。

---

# 环境配置

## docker

### mysql

```
docker run --name mysql-3306 -p 3306:3306 \
-v /mydata/mysql/log:/var/log/mysql \
-v /mydata/mysql/data:/var/lib/mysql \
-v /mydata/mysql/conf:/etc/mysql \
-v /mydata/mysql/mysql-files:/var/lib/mysql-files \
-e MYSQL_ROOT_PASSWORD=root \
-d mysql
```

```
// 进入容器
docker exec -it mysql-3306 bash
// 登录mysql
mysql -u root -p 
// 修改密码
ALTER USER 'root'@'localhost' IDENTIFIED BY 'lianlianjie';

// 8.0版本后，设置访问权限允许远程访问
mysql -u root -p
use mysql;
//Mysql默认不允许远程登录，所以需要开启远程访问权限
select user,authentication_string,host from user;
update user set host = '%' where user = 'root';
FLUSH PRIVILEGES;
//navicat 连接 mysql 出现`Client does not support authentication protocol requested by server`
alter user 'root'@'%' identified with mysql_native_password by 'lianlianjie';

```

---

### redis

```
docker run -p 6379:6379 --name redis-6379 \
-v /mydata/redis/data:/data \
-v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \
-d redis redis-server /etc/redis/redis.conf
```

开启客户端

```
docker exec -it redis-6379 redis-cli
```

在redis.conf中开启aof持久化

```
appendonly yes
```

---

## 插件

### Lombok

### MyBatisX